# ç”µèµ›101 å…¥é—¨ç‰ˆ

*æœ¬æ–‡ä½œè€…æ°´å¹³æœ‰é™ï¼Œç¤¾ç•œåŠ ç­å¤§è„‘é€€åŒ–ï¼Œå¯èƒ½å‡ºç°ç¬”è¯¯æˆ–äº‹å®é”™è¯¯ï¼Œè¯·è¯»è€…è°…è§£*

*æœ¬æ–‡é‡‡ç”¨ [CC BY 4.0](https://creativecommons.org/licenses/by/4.0/legalcode.txt)åè®®*

*åˆ›å»ºæ—¶é—´ï¼š2024/10/01 ğŸ‚*


*ä½œè€…ï¼š nmpassthf nmpassthf@gmail.com*

åœ¨ç”µèµ›ä¸­ï¼ŒåŒå­¦ä»¬éœ€è¦ç¼–å†™çš„è½¯ä»¶å¤§éƒ¨åˆ†æ˜¯é¢å‘**ä½åŠŸè€—Arm**èŠ¯ç‰‡çš„ï¼Œæ‰€ä»¥æœ¬æ•™ç¨‹å°†ä»¥ **STM32F429** è¿™æ¬¾èŠ¯ç‰‡ä¸ºæ ·ä¾‹ï¼Œå‘åŒå­¦ä»¬ç®€å•ä»‹ç»ä¸€ä¸‹å¦‚ä½•å®‰è£…æ‰€éœ€çš„å¼€æºå·¥å…·å¹¶è‡ªå·±åŠ¨æ‰‹ç¼–å†™ä¸€ä¸ªåµŒå…¥å¼ç¨‹åºã€‚

------

[TOC]

------

## Chap 0 ä»€ä¹ˆæ˜¯åµŒå…¥å¼ç¨‹åºï¼Ÿ

ä¼—æ‰€å‘¨çŸ¥ï¼Œä»¥**Cè¯­è¨€**ä¸ºä¾‹ï¼Œæ„å»ºä¸€ä¸ªå¯ä»¥åœ¨æ¡Œé¢ç¯å¢ƒä¸­å¯ä»¥è¿è¡Œçš„ç¨‹åºçš„åŸºæœ¬æ­¥éª¤ä¸ºï¼š**ç¼–å†™Source-ç¼–è¯‘-é“¾æ¥-è¿è¡Œ-(è°ƒè¯•)** 

åœ¨åµŒå…¥å¼ç¯å¢ƒä¸­ï¼Œæµç¨‹ä¹Ÿæ˜¯ä¸€è‡´çš„ï¼Œåªä¸è¿‡å’Œæˆ‘ä»¬ä¹‹å‰æ‰€å­¦åˆ°çš„ç¨‹åºæœ‰äº›è®¸å¼‚åŒï¼š

1ã€è¿è¡Œç¯å¢ƒ: **åµŒå…¥å¼ç¨‹åºé€šå¸¸æ˜¯ä¸€ä¸ªè£¸æœºç¨‹åºï¼Œæˆ–è¿è¡Œåœ¨å®æ—¶æ“ä½œç³»ç»Ÿä¸­**

å› æ­¤ï¼Œé€šå¸¸**ä¸æ¨è**ä¸€ä¸ªåµŒå…¥å¼ç¨‹åºä½¿ç”¨å †å†…å­˜ã€‚è¿™æ˜¯ç”±äºï¼š

- é€šå¸¸æƒ…å†µä¸‹åµŒå…¥å¼ç¯å¢ƒä¸­çš„è®¤ä¸ºåˆ’åˆ†ç»™å †çš„å†…å­˜æ¯”è¾ƒå°‘ã€‚
- ä¸€æ—¦å‡ºç°å†…å­˜æ³„æ¼å‡ ä¹æ²¡æœ‰æ“ä½œç³»ç»Ÿå…œåº•ã€‚
- å¼•å…¥å †å†…å­˜ä¼šæå¤§åœ°é™ä½ç¨‹åºçš„é²æ£’æ€§ï¼Œå¹¶æé«˜è½¯ä»¶éƒ¨åˆ†çš„å¤æ‚åº¦ã€‚

2ã€ç¡¬ä»¶ç¯å¢ƒï¼š**åµŒå…¥å¼ç¨‹åºé€šå¸¸è¿è¡Œåœ¨MCUä¸­ï¼Œé€šè¿‡GPIOã€ADCã€DACç­‰ç‰©ç†å¤–è®¾å®ç°å„ç±»åŠŸèƒ½**

å› æ­¤ï¼Œä¸€ä¸ªåµŒå…¥å¼ç¨‹åºçš„ç¨‹åºæœ¬èº«çš„å¤§å°å’Œè¿è¡Œæ—¶å¤§å°å°†å—é™äºMCUå†…ç½®çš„flashå¤§å°å’Œæ‰©å±•çš„flashã€sdramå­˜å‚¨å®¹é‡ã€‚åœ¨åˆ†é…æ ˆå˜é‡å’Œå…¨å±€å˜é‡çš„æ—¶å€™éœ€è¦ç‰¹åˆ«æ³¨æ„å†…å­˜çš„å ç”¨é—®é¢˜ã€‚

åŒæ—¶ï¼Œè¿‘ä¹æ‰€æœ‰å¤–è®¾éƒ½éœ€è¦ç¨‹åºå‘˜é€šè¿‡å†™å¯„å­˜å™¨ç­‰æ–¹å¼**è‡ªè¡Œåˆå§‹åŒ–**ã€‚

åˆå§‹åŒ–å¤–è®¾ï¼Œå¹¶ä¸ºå„ç§å¤–è®¾ç¼–å†™ç¨‹åºå°±æ˜¯åµŒå…¥å¼ç¨‹åºä¸»è¦çš„å†…å®¹ã€‚

3ã€ç¼–è¯‘ç¯å¢ƒï¼šåµŒå…¥å¼ç¨‹åºçš„**åº•å±‚CPUæ¶æ„**ï¼ˆARM Cortex-Mä¹‹ç±»çš„ï¼‰é€šå¸¸ä¸ä½ ç¼–å†™ç¨‹åºçš„ç¯å¢ƒï¼ˆx86_64ã€AArch64ï¼‰**ä¸ä¸€è‡´**

å› æ­¤ï¼Œä¸ºäº†ç¼–è¯‘å¹¶è°ƒè¯•å¼‚æ„ç¨‹åºï¼Œæˆ‘ä»¬æ‰éœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„å·¥å…·é“¾**äº¤å‰ç¼–è¯‘**ï¼šåœ¨æœ¬æœºçš„æ¶æ„ä¸­ç¼–å†™ã€ç¼–è¯‘ã€é“¾æ¥å…¶ä»–æ¶æ„çš„ç¨‹åºã€‚

4ã€çƒ§å½•å’Œè°ƒè¯•ï¼š

ç”±äºåµŒå…¥å¼MCUé€šå¸¸ä½¿ç”¨å†…ç½®çš„SRAMã€flashä½œä¸ºå­˜å‚¨å•å…ƒï¼Œå› æ­¤ç¼–è¯‘å¥½çš„ç¨‹åºä¹Ÿéœ€è¦ä½¿ç”¨å¯¹åº”çš„ç¡¬ä»¶çƒ§å½•å™¨å°†ç¨‹åºå†™å…¥åˆ°èŠ¯ç‰‡å†…éƒ¨ä¸­ã€‚

å¸¸è§çš„è°ƒè¯•å™¨åŒæ—¶ä¹Ÿå…·å¤‡çƒ§å½•çš„åŠŸèƒ½ï¼ˆä¾‹å¦‚STçš„ST-LINK/V2ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¡¬ä»¶è°ƒè¯•å™¨æ¥çƒ§å½•ç¨‹åºæˆ–è€…è®©GDB detachåˆ°åµŒå…¥å¼çš„ç¨‹åºä¸­æ‰“æ–­ç‚¹è°ƒè¯•ã€‚

## Chap 1 ç¼–å†™-ç¼–è¯‘-çƒ§å½•-è°ƒè¯• æ‰€éœ€çš„å·¥å…·

### Chap 1.1 å·¥å…·é“¾ç®€ä»‹

åœ¨æ­¤æ–‡ä¸­ï¼Œæˆ‘å°†ä»‹ç»ä½¿ç”¨**VSCode + CubeMX + XMake (GNU make)+ Arm-none-eabi-GCC + OpenOCD **å·¥å…·æ¥æ„å»ºä¸€ä¸ªåµŒå…¥å¼å·¥ç¨‹ã€‚

åœ¨æ­¤ï¼Œä¸å¯¹è¿™äº›å¼€æºå·¥å…·åšè¿‡å¤šæ•™ç¨‹ï¼Œè¿™äº›å·¥å…·çš„å®˜ç½‘éƒ½æœ‰å¾ˆè¯¦ç»†çš„æ–‡æ¡£ï¼Œå¤§å®¶å¯ä»¥å…ˆæŒ‰ç…§æˆ‘çš„é…ç½®è¿‡ç¨‹ç¨åŠ æ”¹åŠ¨ï¼Œé€‚åº”è‡ªå·±çš„å¼€å‘æ¿å³å¯ã€‚

åœ¨è¿™ä¸²å·¥å…·ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ï¼š

**VSCode**ç¼–è¾‘ã€æµè§ˆã€è°ƒè¯•ä»£ç ã€‚

**CubeMX**åˆ›å»ºå·¥ç¨‹å¹¶å¤åˆ¶æ‰€éœ€çš„HALï¼ˆæˆ–è€…LLï¼‰åº“åˆ°æˆ‘ä»¬çš„å·¥ç¨‹è·¯å¾„ï¼Œå¹¶ç”Ÿæˆæˆ‘ä»¬æ‰€éœ€çš„é“¾æ¥è„šæœ¬å’Œå¯åŠ¨æ±‡ç¼–ã€‚

**äº¤å‰ç¼–è¯‘å™¨**:ARMå‘è¡Œçš„**arm-none-eabi-gcc**ã€‚

**OpenOCD**å°†ç”Ÿæˆçš„hexæ–‡ä»¶çƒ§å½•åˆ°ç›®æ ‡å•ç‰‡æœºã€‚

**OpenOCD+GDB**è¿œç¨‹è°ƒè¯•åµŒå…¥å¼ç¨‹åºã€‚

å¯é€‰é¡¹ï¼š

**Git**ç‰ˆæœ¬æ§åˆ¶è½¯ä»¶ï¼Œæ–¹ä¾¿ç®¡ç†æºç çš„ç‰ˆæœ¬ã€‚

### Chap 1.2 è‡ªåŠ¨åŒ–æ„å»ºè½¯ä»¶

å¯¹äºä¸€ä¸ªæºæ–‡ä»¶ä¼—å¤šçš„å¤§å‹åº”ç”¨æ¥è¯´ï¼Œä½¿ç”¨è¿™ç±»è‡ªåŠ¨åŒ–æ„å»ºè½¯ä»¶å¯ä»¥æå¤§åœ°å‡å°‘ç¼–è¯‘æ—¶çš„å·¥ä½œé‡ï¼Œå¹¶åŠ å¿«ç¼–è¯‘é€Ÿåº¦ã€‚å¯¹äºC/C++è¯­è¨€æ„å»ºçš„é¡¹ç›®æ¥è¯´ï¼ŒXMakeã€CMakeå’ŒGNU makeç­‰ä¸€ä¼—è½¯ä»¶éƒ½å¯ä»¥å®ç°æ­¤åŠŸèƒ½ã€‚

å› ä¸ºé€‰æ‹©ä¸åŒçš„è‡ªåŠ¨åŒ–æ„å»ºè½¯ä»¶ä¼š**å½±å“åˆ°æ¥ä¸‹æ¥é…ç½®VSCodeç¼–è¾‘å™¨çš„æ’ä»¶**ï¼Œå› æ­¤æœ¬æ–‡åˆ—å‡ºäº†ä¸¤ç±»åŒºåˆ«è¾ƒå¤§çš„è‡ªåŠ¨åŒ–æ„å»ºè½¯ä»¶ã€‚

**å¯ä»¥æ ¹æ®è‡ªèº«å–œå¥½é€‰æ‹©å…¶ä¸€ä½¿ç”¨**

[Chap3](#Chap3ä½¿ç”¨XMake+clangdIntelliSense) ä¸­å°†è¯¦ç»†ä»‹ç»åŸºäºXMakeå·¥å…·çš„é…ç½®æ–¹æ³•ã€‚

[Chap4](#chap-4-ä½¿ç”¨GNU-make--microsoft-cc-intellisense) ä¸­å°†è¯¦ç»†ä»‹ç»åŸºäºGNU makeå·¥å…·çš„é…ç½®æ–¹æ³•ã€‚

### Chap 1.3 å®‰è£…å‰çŸ¥è¯†ç‚¹

#### Chap 1.3.1 ç¯å¢ƒå˜é‡

æŒ‡çš„æ˜¯å°†æŸä¸€ä¸ªå¯ä»¥è¿è¡Œçš„å¯æ‰§è¡Œç¨‹åºçš„**ç›®å½•**æ·»åŠ è¿›æ“ä½œç³»ç»Ÿçš„Pathæœç´¢ç›®å½•ä¸­ã€‚

ï¼ˆe.g. å°†ä½äº`C:\ENV\openocd\bin\openocd.exe` çš„**openocdå¯æ‰§è¡Œç¨‹åº**åŠ å…¥pathï¼Œè¯·å°†`C:\ENV\openocd\bin`è¿½åŠ å†™å…¥**Path**ä¸­ï¼‰

åœ¨Windows 11çš„æ“ä½œæµç¨‹ä¸ºï¼š

![1.3.1.1](./Assets/Sc/1.3.1.1.png)

![1.3.1.2](./Assets/Sc/1.3.1.2.png)

Linux ä¸‹å¯ä»¥é€šè¿‡å‘ `/etc/profile.d/`ä¸‹æ–°å¢profileæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ·»åŠ ç¯å¢ƒå˜é‡ã€‚

```sh
export PATH='$PATH:/usr/local/openocd/bin'
```

#### Chap 1.3.2 å–„ç”¨äº’è”ç½‘

å¾ˆå¤šé—®é¢˜éƒ½å¯ä»¥åœ¨ç½‘ä¸Šè·å–åˆ°ç­”æ¡ˆã€‚

ç¼–ç¨‹ç±»é—®é¢˜ï¼šæ¨èä½¿ç”¨è‹±æ–‡åœ¨Googleç­‰æœç´¢å¼•æ“ä¸­æ£€ç´¢ï¼Œè¿™æ¯”ç•™è¨€æé—®é«˜æ•ˆçš„å¤š ã€‚

ç¼–è¯‘å‚æ•°/è½¯ä»¶é€‰é¡¹/ä½¿ç”¨æ–‡æ¡£ï¼šæ¨èæŸ¥è¯¢å¯¹åº”è½¯ä»¶çš„å®˜ç½‘ï¼Œéƒ½ä¼šæ•´ç†å‡ºDocumentæˆ–Manualï¼ˆæ³¨æ„ç‰ˆæœ¬å·ï¼‰ã€‚

e.g. [GNU Make Manual](https://www.gnu.org/software/make/manual/make.html)

## Chap 2 åŸºç¡€ç»„ä»¶å®‰è£…

æœ¬æ–‡ä¸­ï¼Œé»˜è®¤è¯»è€…ä½¿ç”¨æœ€æ–°çš„ x86_64æ¶æ„çš„ Windows 10/11 64bit æ“ä½œç³»ç»Ÿã€‚

*å¯¹äºä½¿ç”¨Ubuntuæˆ–Fedoraç­‰Linuxç³»ç»Ÿçš„è¯»è€…ï¼Œå¯ä»¥é€šè¿‡åŒ…ç®¡ç†å™¨ç®€åŒ–å®‰è£…çš„æ­¥éª¤ï¼›éƒ¨åˆ†é…ç½®é¡¹å’Œè·¯å¾„å¯èƒ½ä¸æ–‡ä¸­æ‰€åˆ—ä¸åŒã€‚*

***æ–‡ä¸­å¤§éƒ¨åˆ†å·¥å…·ä½¿ç”¨é»˜è®¤å®‰è£…è·¯å¾„ï¼Œè¯·æ³¨æ„æ ¸å¯¹ä½ è‡ªå·±æ–‡ä»¶è·¯å¾„***

### Chap 2.1 STM32CubeMX

STM32CubeMXæ˜¯STå…¬å¸æ¨å‡ºçš„ä¸€ä¸ªè‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆå™¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ­¤å·¥å…·ä¾¿åˆ©çš„ä¸‹è½½åˆ°STçš„MCUçš„ç›¸å…³å¼€å‘SDKã€é…ç½®MCUç›¸å…³å‚æ•°å¹¶è‡ªåŠ¨ç”Ÿæˆå·¥ç¨‹ã€‚

æˆ‘ä»¬å¯ä»¥ä»STçš„å®˜ç½‘è·å–æ­¤è½¯ä»¶ï¼š[STM32CubeMX](https://www.st.com/en/development-tools/stm32cubemx.html)

### Chap 2.2 MSYS2

> æœ¬ç« èŠ‚å‚è€ƒäº†[MSYS2 Installer](https://www.msys2.org/docs/installer/)

è€ƒè™‘åˆ°æˆ‘ä»¬å¯èƒ½ä½¿ç”¨GNUå·¥å…·é“¾(GNU Make/GCCç­‰å·¥å…·)ï¼Œè·å–å…¶æœ€ä¾¿åˆ©çš„æ–¹å¼æ˜¯é€šè¿‡MSYS2çš„pacmanåŒ…ç®¡ç†å™¨å®‰è£…è¿™äº›å·¥å…·ã€‚

MSYS2æ˜¯ä¸€ä¸ªå·¥å…·å’Œåº“çš„é›†åˆï¼Œå®ƒæä¾›äº†ä¸€ä¸ªåŸºäºå¼€æºè½¯ä»¶çš„æœ¬åœ°æ„å»ºç¯å¢ƒï¼Œç”¨äºæ„å»ºã€å®‰è£…å’Œè¿è¡Œæœ¬åœ° Windows è½¯ä»¶ã€‚

MSYS2 Installerå¯ä»¥ä»[MSYS2 Installer distrib](https://repo.msys2.org/distrib/) æˆ–å…¶ Githubä»“åº“è·å–

ä¸‹è½½å…¶ä¸­çš„ `msys2-x86_64-latest.exe`ç„¶åä½¿ç”¨ 

```cmd
.\msys2-x86_64-latest.exe in --confirm-command --accept-messages --root C:/msys64
```

å®‰è£…MSYS2åˆ°é»˜è®¤è·¯å¾„ï¼š`C:/msys64`ä¸­ã€‚

### Chap 2.3 GCC

å¦‚å‰å‡ èŠ‚æ‰€è¿°ï¼Œç”±äºæˆ‘ä»¬éœ€è¦ä½¿ç”¨äº¤å‰ç¼–è¯‘å™¨ï¼Œå› æ­¤éœ€è¦è·å–arm-none-eabi-gccç¼–è¯‘å™¨ã€‚

arm-none-eabi-gccçš„åå­—ä»£è¡¨ï¼š

- arm: å®ƒç¼–è¯‘çš„targetæ˜¯armæ¶æ„çš„
- none: æ²¡æœ‰ç›®æ ‡æ“ä½œç³»ç»Ÿ
- eabi: åµŒå…¥å¼ABI
- gcc: GCC

### Chap 2.4 OpenOCD

### Chap 2.5 Git

> æœ¬ç« èŠ‚å‚è€ƒäº† [Install inside MSYS2 proper](https://github.com/git-for-windows/git/wiki/Install-inside-MSYS2-proper)



## Chap 3 ä½¿ç”¨XMake + clangd IntelliSense

*ç« èŠ‚æç¤ºï¼šChap 3 å’Œ Chap 4é€‰æ‹©å…¶ä¸€å³å¯*

### Chap 3.1 XMakeå®‰è£…

### Chap 3.2 VSCode(clangd)å®‰è£…

## Chap 4 ä½¿ç”¨GNU make + Microsoft C/C++ IntelliSense

*ç« èŠ‚æç¤ºï¼šChap 3 å’Œ Chap 4é€‰æ‹©å…¶ä¸€å³å¯*

### Chap 4.1 GNU makeå®‰è£…

### Chap 4.2 VSCode(ms IntelliSense)å®‰è£…